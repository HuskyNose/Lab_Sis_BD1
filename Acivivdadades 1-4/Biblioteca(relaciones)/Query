Bilbioteca, relaciones


INSERT INTO AUTOR (NOMBRE, NACIONALIDAD) 
VALUES ('Isaac Asimov', 'Ruso-Estadounidense'); -- Suponiendo que este es el ID 3

INSERT INTO LIBRO_AUTOR (LIBRO_ID, AUTOR_ID, ORDEN_AUTORIA, ROL) 
VALUES (2, 3, 2, 'Co-autor');

INSERT INTO EDICION (LIBRO_ID, EDITORIAL_ID, NUM_EDICION, FECHA_LANZAMIENTO, ISBN_EDICION)
VALUES (1, 1, 2, '2026-01-01', 'ISBN-PALA-V2'); -- Esto genera el ID de Edición 3

INSERT INTO EJEMPLAR (EDICION_ID, CODIGO_BARRAS, UBICACION, ESTADO) VALUES 
(3, 'PALA-V2-001', 'Vitrina de Colección', 'disponible'),
(3, 'PALA-V2-002', 'Estante A1', 'disponible');

INSERT INTO RESERVA (USUARIO_ID, LIBRO_ID, EXPIRA_EN, ESTADO)
VALUES (2, 1, DATE('now', '+3 days'), 'activa');

UPDATE RESERVA SET ESTADO = 'cumplida' WHERE ID = 2; -- Asumiendo que es la reserva 2

INSERT INTO PRESTAMO (USUARIO_ID, OBSERVACIONES) VALUES (2, 'Recogió su reserva'); -- Préstamo ID 2
INSERT INTO PRESTAMO_ITEM (PRESTAMO_ID, EJEMPLAR_ID, FECHA_VENCIMIENTO) 
VALUES (2, 2, DATE('now', '+15 days')); -- Se lleva el ejemplar BC-002


(Comando generado por gemini para la verificacion de las relaciones)
SELECT 
    A.NOMBRE AS Escritor,
    L.TITULO AS Obra,
    ED.NUM_EDICION AS Edicion,
    EJ.CODIGO_BARRAS AS Etiqueta,
    U.NOMBRE AS Poseedor_Actual
FROM AUTOR A
JOIN LIBRO_AUTOR LA ON A.ID = LA.AUTOR_ID
JOIN LIBRO L ON LA.LIBRO_ID = L.ID
JOIN EDICION ED ON L.ID = ED.LIBRO_ID
JOIN EJEMPLAR EJ ON ED.ID = EJ.EDICION_ID
LEFT JOIN PRESTAMO_ITEM PI ON EJ.ID = PI.EJEMPLAR_ID AND PI.ESTADO = 'activo'
LEFT JOIN PRESTAMO P ON PI.PRESTAMO_ID = P.ID
LEFT JOIN USUARIO U ON P.USUARIO_ID = U.ID
ORDER BY L.TITULO;